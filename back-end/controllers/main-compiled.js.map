{"version":3,"sources":["main.js"],"names":[],"mappings":"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","file":"main-compiled.js","sourcesContent":["'use strict';\r\n\r\nvar async = require('async');\r\nvar debug = require('debug');\r\nvar scheduleDB = require('../db/scheduleDB');\r\nvar dayDB = require('../db/dayDB');\r\nvar keyDB = require('../db/parameterKeysDB');\r\nvar objectDB = require('../db/objectDB');\r\nvar parameterDB = require('../db/parameterDB');\r\n\r\n/* GET FUNCTIONS */\r\n\r\nclass Schedule {\r\n    constructor(schedule){\r\n\r\n    }\r\n}\r\n\r\nexports.getSchedulesName = function (email, callback) {\r\n    async.waterfall([\r\n        function (callback) {\r\n            scheduleDB.getSchedulesByEmail(email, callback);\r\n        },\r\n        function (schedules, callback) {\r\n            console.log(schedules);\r\n            async.map(schedules, function (info, callback) {\r\n                callback(null, info['name']);\r\n            }, callback);\r\n        }\r\n    ], callback);\r\n};\r\n\r\n/* GET SCHEDULE INFORMATION */\r\n\r\nexports.sendScheduleInformation = function (email, name, callback) {\r\n    async.parallel({\r\n        objects: async.apply(getObjectsInfo, email, name),\r\n        days: async.apply(dayDB.get, email, name),\r\n        keys: async.apply(getKeys, email, name)\r\n    }, callback);\r\n};\r\n\r\nfunction getKeys(email, name, callback) {\r\n    async.waterfall([\r\n        async.apply(keyDB.get, email, name),\r\n        function (keys, callback) {\r\n            async.map(keys, function (info, callback) {\r\n                callback(null, info['name']);\r\n            }, callback)\r\n        }\r\n    ], callback)\r\n}\r\n\r\nfunction getObjectsInfo(email, scheduleName, callback) {\r\n    async.waterfall([\r\n        async.apply(objectDB.get, email, scheduleName),\r\n        addParametersInformation\r\n    ], callback);\r\n}\r\n\r\nfunction addParametersInformation(objects, callback) {\r\n    async.map(objects, function (info, callback) {\r\n        async.waterfall([\r\n            async.apply(getParameter, info['idObject']),\r\n            function (parameters, callback) {\r\n                info['parameters'] = parameters;\r\n                callback(null, info);\r\n            }\r\n        ], callback)\r\n    }, callback)\r\n}\r\n\r\nfunction getParameter(idObject, callback) {\r\n    async.waterfall([\r\n        async.apply(parameterDB.get, idObject),\r\n        function (parameters, callback) {\r\n            var obj = {};\r\n            async.each(parameters, function (info, callback) {\r\n                obj[info['name']] = info['value'];\r\n                callback();\r\n            }, function (err) {\r\n                if (err) {\r\n                    callback(err);\r\n                } else {\r\n                    callback(null, obj);\r\n                }\r\n            });\r\n        }\r\n    ], callback);\r\n}\r\n\r\n/* SAVE SCHEDULE FUNCTIONS */\r\n\r\nexports.saveSchedule = function (schedule, callback) {\r\n    async.waterfall([\r\n        async.apply(checkScheduleExist, schedule['email'], schedule['name']),\r\n        function (isExist, callback) {\r\n            if (isExist) {\r\n                callback(null, false)\r\n            } else {\r\n                //TODO think about other parameters. For example (email, name)\r\n                scheduleDB.insertSchedule(schedule, callback);\r\n            }\r\n        }\r\n    ], callback);\r\n};\r\n\r\nfunction checkScheduleExist(email, name, callback) {\r\n    async.waterfall([\r\n        async.apply(scheduleDB.getScheduleByEmailAndName, email, name),\r\n        function (schedule, callback) {\r\n            callback(null, !!schedule);\r\n        }\r\n    ], callback);\r\n}\r\n\r\n/* SAVE DAYS FUNCTIONS */\r\n\r\nexports.saveDay = function (day, callback) {\r\n    async.waterfall([\r\n        async.apply(checkDayExist, day['email'], day['scheduleName'], day['name']),\r\n        function (isExist, callback) {\r\n            if (isExist) {\r\n                callback(null, false);\r\n            } else {\r\n                dayDB.insert(day, callback);\r\n            }\r\n        }\r\n    ], callback);\r\n};\r\n\r\nfunction checkDayExist(email, scheduleName, name, callback) {\r\n    async.waterfall([\r\n        async.apply(dayDB.getByName, email, scheduleName, name),\r\n        function (day, callback) {\r\n            callback(null, day.length > 0);\r\n        }\r\n    ], callback);\r\n}\r\n\r\n/* SAVE KEY FUNCTIONS */\r\n\r\nexports.saveKey = function (key, saveKeyCallback){\r\n    async.waterfall([\r\n        async.apply(checkKeyExist, key),\r\n        function (isExist, callback) {\r\n            if(isExist){\r\n                callback(null, false);\r\n            } else {\r\n                keyDB.insert(key, callback);\r\n            }\r\n        }\r\n    ], saveKeyCallback);\r\n};\r\n\r\nfunction checkKeyExist(key, callback) {\r\n    async.waterfall([\r\n        async.apply(keyDB.getByName, key['email'], key['scheduleName'], key['name']),\r\n        function (key, callback) {\r\n            callback(null, !!key);\r\n        }\r\n    ], callback);\r\n}\r\n\r\n/* SAVE OBJECT FUNCTIONS */\r\n\r\nexports.saveObject = function (object, saveObjectCallback) {\r\n    async.waterfall([\r\n        async.apply(objectDB.getByName, object['email'], object['scheduleName'], object['name']),\r\n        addParametersInformation,\r\n        function (scheduleObjects, callback) {\r\n            if (scheduleObjects.length > 0) {\r\n                checkEqualParameters(scheduleObjects, object, callback);\r\n            } else {\r\n                callback(null, false);\r\n            }\r\n        },\r\n        function (isEqualParameters, callback) {\r\n            if (isEqualParameters) {\r\n                callback(null, false);\r\n            } else {\r\n                async.waterfall([\r\n                    async.apply(objectDB.insert, object),\r\n                    async.apply(saveParameters, object['parameters'])\r\n                ], callback);\r\n            }\r\n        }\r\n    ], saveObjectCallback);\r\n};\r\n\r\nfunction saveParameters(parameters, idObject, callback) {\r\n    console.log(idObject, parameters);\r\n    async.eachOf(parameters, function (value, key, callback) {\r\n        console.log(idObject, value, key);\r\n        parameterDB.insert(idObject, value, key, callback);\r\n    }, function (err) {\r\n        if(err){\r\n            callback(err);\r\n        } else{\r\n            callback(null, true);\r\n        }\r\n    });\r\n}\r\n\r\n//TODO check various length of parameters!\r\nfunction checkEqualParameters(scheduleObjects, object, callback) {\r\n    var keys = Object.keys(object['parameters']);\r\n    async.some(scheduleObjects, function (info, callback) {\r\n        async.every(keys, function (key, callback) {\r\n            // as a result return 'true' if parameter is exist and 'false' if not\r\n            callback(null, info['parameters'][key] && info['parameters'][key] == object['parameters'][key]);\r\n        }, callback);\r\n\r\n    }, callback)\r\n}\r\n\r\n/* DELETE SCHEDULE INFORMATION */\r\n\r\nexports.deleteSchedule = function (email, name, callback) {\r\n    scheduleDB.deleteSchedule(email, name, callback);\r\n};\r\n\r\n\r\n/* DELETE OBJECT INFORMATION */\r\n\r\nexports.deleteObject = function (object, callback) {\r\n    objectDB.deleteObject(object, callback);\r\n};\r\n\r\n/* DELETE PARAMETER INFORMATION */\r\n\r\nexports.deleteParameter = function (parameter, callback) {\r\n\r\n};"]}